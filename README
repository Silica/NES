NES - Native Embeddable Script

x86 JIT コンパイル機能を持ったC++から呼び出せる簡易組み込み言語
実用ではなく実験目的で作りました
ついでなのでWindows用のexeを吐けるネイティブコンパイラも作りました

取り敢えず作っただけなので、モノ的にもコード的にも色々アレですが
お察し下さい
変なコメントも残ってるかもしれない

いつも通りincludeすれば使えます
但しインターフェースを整備していません

機械語ではなく中間言語の状態で実行することも出来ます
が、64bitではコンパイル出来ないと思いますし、出来ても動かないと思います

言語の表現能力はC言語程度です
書けるけど未実装の機能もあります
forとかswitchはありません

やりたかったこと1:JIT
JITは大抵のコンパイラで試そうとするとデータ領域をコードとして実行出来ないので
BCC(5.5.1)ぐらいでしか試せていません

やりたかったこと2:静的型
ですがキャストは全くありません(unionならありますが)
凄く書き辛いです
型チェックはしてるところとしてないところがあります
手動なので全部書くの面倒です
データ型はint uint char bool float
配列とポインタ、関数ポインタ
doubleは(メモリ上の)大きさがややこしいのでfloatだけ用意しようと思ったんですが
floatを返す関数もFPUスタックを使うことに気付いて対応が途中で止まりました
他もどこまで動くかは怪しいものがあります

やりたかったこと3:
型推論などという気の利いたものはありませんが
ローカル変数の型省略ぐらいは可能です
初期化値に応じて自動的に決まります

やりたかったこと4:
グローバル変数の初期化はコンパイル時に行われます
constexprとか関係なく何でも実行出来ますが(中間言語実行と同等)
無限ループとか無限再帰とか相互参照とか考慮しないので書き方を間違えると死にます

Cの標準関数は大体何でも使える様に出来ると思うのですが
(...に対応してないのでprintf系は使えないです、引数の型を固定した使い方をするなら別ですが)
今は面倒なのでputsとputcharとgetcharしか用意してません
そもそもどこまでちゃんと動くか分かりません
エラーチェックとかも2重の意味で全然です
吐く機械語は何の最適化もしないことを抜きにしても効率が悪いです
